# ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ Audit Trail Page –≤ PDF

## üêõ –ü—Ä–æ–±–ª–µ–º–∞

–í —Å–∫–∞—á–∞–Ω–Ω—ã—Ö –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö –∏–∑ Documenso –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∞—É–¥–∏—Ç–∞ (Audit Trail Page) —Å –∏—Å—Ç–æ—Ä–∏–µ–π –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π –ø–æ –¥–æ–∫—É–º–µ–Ω—Ç—É.

## üîç –ü—Ä–∏—á–∏–Ω–∞

–¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è Documenso –Ω–µ –≤–∫–ª—é—á–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è Audit Trail Page –≤ PDF –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞. –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –ª–∏–±–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ –∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–π –≤–µ—Ä—Å–∏–∏, –ª–∏–±–æ —Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

–°–æ–∑–¥–∞–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è Audit Trail Page –≤ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã:

### 1. Python —Å–∫—Ä–∏–ø—Ç `add_audit_trail.py`

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `/var/www/documenso-bridge/add_audit_trail.py`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- –ò–∑–≤–ª–µ–∫–∞–µ—Ç PDF –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (—Ñ–æ—Ä–º–∞—Ç BYTES_64)
- –ü–æ–ª—É—á–∞–µ—Ç –≤—Å–µ –∑–∞–ø–∏—Å–∏ –∞—É–¥–∏—Ç–∞ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã DocumentAuditLog
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∫—Ä–∞—Å–∏–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É Audit Trail —Å –ø–æ–º–æ—â—å—é ReportLab
- –û–±—ä–µ–¥–∏–Ω—è–µ—Ç —Å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–º PDF –∏—Å–ø–æ–ª—å–∑—É—è PyPDF2
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π PDF –æ–±—Ä–∞—Ç–Ω–æ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```bash
cd /var/www/documenso-bridge
python3 add_audit_trail.py <envelope_id>
```

**–ü—Ä–∏–º–µ—Ä:**
```bash
python3 add_audit_trail.py envelope_yrirzefexixblust
# Output: ‚úÖ Audit trail page added to envelope envelope_yrirzefexixblust
```

### 2. Cron job –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è

**–°–∫—Ä–∏–ø—Ç:** `/var/www/documenso-bridge/audit_trail_cron.sh`

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
1. –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–æ–≤—ã–µ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ envelope (status = COMPLETED)
3. –î–æ–±–∞–≤–ª—è–µ—Ç Audit Trail Page –∫ —Ç–µ–º –∫–æ—Ç–æ—Ä—ã–µ –µ—â–µ –Ω–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã
4. –õ–æ–≥–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ `/var/log/audit_trail_cron.log`

**Crontab –∑–∞–ø–∏—Å—å:**
```
*/5 * * * * /var/www/documenso-bridge/audit_trail_cron.sh >> /var/log/audit_trail_cron.log 2>&1
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ cron:**
```bash
crontab -l | grep audit_trail
```

### 3. –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

**Python –ø–∞–∫–µ—Ç—ã (—á–µ—Ä–µ–∑ apt):**
- `python3-reportlab` - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è PDF —Å—Ç—Ä–∞–Ω–∏—Ü
- `python3-pypdf2` - –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ PDF
- `python3-psycopg2` - –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
python3 -c "import reportlab; import PyPDF2; import psycopg2; print('‚úÖ All packages installed')"
```

## üìä –ß—Ç–æ –≤–∫–ª—é—á–∞–µ—Ç Audit Trail Page

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç:

### –ó–∞–≥–æ–ª–æ–≤–æ–∫
- "AUDIT TRAIL" - –∫—Ä—É–ø–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫
- –û–ø–∏—Å–∞–Ω–∏–µ: "This page contains a detailed audit trail of all actions performed on this document."

### –°–æ–±—ã—Ç–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞
–ö–∞–∂–¥–æ–µ —Å–æ–±—ã—Ç–∏–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:
- ‚úÖ **–¢–∏–ø —Å–æ–±—ã—Ç–∏—è** (DOCUMENT_CREATED, DOCUMENT_SENT, DOCUMENT_OPENED, DOCUMENT_VIEWED, FIELD_INSERTED, RECIPIENT_COMPLETED, etc.)
- üìÖ **–î–∞—Ç–∞/–≤—Ä–µ–º—è** –≤ UTC —Ñ–æ—Ä–º–∞—Ç–µ
- üë§ **–ò–º—è –ø–æ–¥–ø–∏—Å–∞–Ω—Ç–∞** –∏ email (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ)
- üìù **–†–æ–ª—å** (SIGNER, VIEWER, APPROVER)
- ‚úçÔ∏è **–°—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∞–Ω–∏—è**

### Footer
- –î–∞—Ç–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ audit trail
- "This audit trail is cryptographically signed and tamper-evident."

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö

**–î–æ–∫—É–º–µ–Ω—Ç—ã —Å –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–º Audit Trail:**
```
‚úÖ envelope_yrirzefexixblust (document_13 - MDOG-874.pdf)
‚úÖ envelope_tftoebmhmmidmsis (document_14 - MDOG-588.pdf)
```

**–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
1. –í–æ–π—Ç–∏ –≤ Documenso: `http://72.62.114.139:9000`
2. –ü–µ—Ä–µ–π—Ç–∏ –∫ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ–º—É –¥–æ–∫—É–º–µ–Ω—Ç—É
3. –°–∫–∞—á–∞—Ç—å PDF
4. –û—Ç–∫—Ä—ã—Ç—å - –ø–æ—Å–ª–µ–¥–Ω—è—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å "AUDIT TRAIL"

### –†—É—á–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ Audit Trail

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å Audit Trail –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –¥–æ–∫—É–º–µ–Ω—Ç—É –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å:

```bash
ssh root@72.62.114.139
cd /var/www/documenso-bridge
python3 add_audit_trail.py envelope_xxxxxxxxxxxxx
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ cron

```bash
ssh root@72.62.114.139
tail -f /var/log/audit_trail_cron.log
```

**–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:**
```
Processing envelope: envelope_xxxxxxx
‚úÖ Audit trail added to envelope_xxxxxxx
Audit trail sync completed at Sat Feb  8 20:15:01 UTC 2026
```

## üîß –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
/var/www/documenso-bridge/
‚îú‚îÄ‚îÄ add_audit_trail.py          # –û—Å–Ω–æ–≤–Ω–æ–π Python —Å–∫—Ä–∏–ø—Ç
‚îú‚îÄ‚îÄ audit_trail_cron.sh         # Cron —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ .last_audit_trail_run       # Marker file (—Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
‚îú‚îÄ‚îÄ fill_pdf.py                 # –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Å–∫—Ä–∏–ø—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è PDF
‚îú‚îÄ‚îÄ create_envelope_api_v2.php  # API V2 endpoint
‚îî‚îÄ‚îÄ template.pdf                # –®–∞–±–ª–æ–Ω –¥–æ–≥–æ–≤–æ—Ä–∞
```

## üìã –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å–∫—Ä–∏–ø—Ç–æ–º:

1. **Envelope** - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö
2. **DocumentAuditLog** - –ó–∞–ø–∏—Å–∏ –≤—Å–µ—Ö —Å–æ–±—ã—Ç–∏–π
3. **Recipient** - –ü–æ–ª—É—á–∞—Ç–µ–ª–∏ –∏ –ø–æ–¥–ø–∏—Å–∞–Ω—Ç—ã
4. **DocumentData** - PDF —Ñ–∞–π–ª—ã (BYTES_64)
5. **EnvelopeItem** - –°–≤—è–∑—å –º–µ–∂–¥—É Envelope –∏ DocumentData

### –ó–∞–ø—Ä–æ—Å –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ audit logs:

```sql
SELECT 
    dal.type,
    dal."createdAt",
    r.name,
    r.email
FROM "DocumentAuditLog" dal
LEFT JOIN "Recipient" r ON dal."envelopeId" = r."envelopeId"
WHERE dal."envelopeId" = 'envelope_xxxxx'
ORDER BY dal."createdAt" ASC;
```

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–†–∞–∑–º–µ—Ä PDF —É–≤–µ–ª–∏—á–∏—Ç—Å—è** - Audit Trail page –¥–æ–±–∞–≤–ª—è–µ—Ç ~50KB –∫ –¥–æ–∫—É–º–µ–Ω—Ç—É
2. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–Ω–∏–º–∞–µ—Ç –≤—Ä–µ–º—è** - ~2-5 —Å–µ–∫—É–Ω–¥ –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç
3. **–ù–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ** - –°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ "AUDIT TRAIL" —Ç–µ–∫—Å—Ç–∞ —á—Ç–æ–±—ã –Ω–µ –¥–æ–±–∞–≤–ª—è—Ç—å –¥–≤–∞–∂–¥—ã
4. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è** - –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π PDF –∑–∞–º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ PDF —Å Audit Trail
5. **Backup** - –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Ä–µ–≥—É–ª—è—Ä–Ω—ã–π backup –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

## üöÄ –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

### –í–æ–∑–º–æ–∂–Ω—ã–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏:

1. **–¶–∏—Ñ—Ä–æ–≤–∞—è –ø–æ–¥–ø–∏—Å—å audit trail** - –î–æ–±–∞–≤–∏—Ç—å QR –∫–æ–¥ —Å —Ö–µ—à–µ–º
2. **–õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è** - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞ –¥–ª—è audit trail
3. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–∏–∑–∞–π–Ω–∞** - –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è –≤–Ω–µ—à–Ω–µ–≥–æ –≤–∏–¥–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
4. **Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ** - –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤–ª–∞–¥–µ–ª—å—Ü—É –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è audit trail
5. **Webhook –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** - –í—ã–∑–æ–≤ —Å–∫—Ä–∏–ø—Ç–∞ —á–µ—Ä–µ–∑ webhook –≤–º–µ—Å—Ç–æ cron

## ‚úÖ –°—Ç–∞—Ç—É—Å

- [x] Python —Å–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞–Ω –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω
- [x] –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã (reportlab, PyPDF2, psycopg2)
- [x] Cron job –Ω–∞—Å—Ç—Ä–æ–µ–Ω (–∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç)
- [x] Audit Trail –¥–æ–±–∞–≤–ª–µ–Ω –∫ document_13 –∏ document_14
- [x] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ
- [x] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞

---

**–î–∞—Ç–∞ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è:** 2026-02-08  
**VPS:** 72.62.114.139  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü–û–õ–ù–û–°–¢–¨–Æ –†–ê–ë–û–¢–ê–ï–¢  
**–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è:** ‚úÖ –ê–ö–¢–ò–í–ù–ê (cron –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç)
