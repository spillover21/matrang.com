<!doctype html>
<html lang="en">
  <head>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MATRANG App</title>
    <meta name="description" content="MATRANG Project" />
    <meta name="author" content="MATRANG" />
    <meta property="og:title" content="MATRANG App" />
    <meta property="og:description" content="MATRANG Project" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="https://lovable.dev/opengraph-image-p98pqg.png" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@MATRANG" />
    <meta name="twitter:image" content="https://lovable.dev/opengraph-image-p98pqg.png" />
    <script src="https://unpkg.com/@pdf-lib/fontkit/dist/fontkit.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    <script type="module" crossorigin src="/assets/index-DV35XX7a-1770415401967.js"></script>
    <link rel="stylesheet" crossorigin href="/assets/index-YCShfBMU.css">
  </head>
  <body>
    <div id="root"></div>
    
    <!-- VANILLA JS BRIDGE - PROFILE BUTTONS -->
    <div id="vanilla-profile-ui" style="display: none; gap: 8px;">
         <button id="btn-save-profile" style="font-size: 12px; padding: 6px 10px; background: #334155; color: white; border: 1px solid #475569; border-radius: 4px; cursor: pointer;">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
         <button id="btn-load-profile" style="font-size: 12px; padding: 6px 10px; background: #334155; color: white; border: 1px solid #475569; border-radius: 4px; cursor: pointer;">üì• –í—Å—Ç–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
    </div>

    <style>
      #vanilla-profile-ui button { transition: all 0.2s; }
      #vanilla-profile-ui button:active { transform: scale(0.95); }
    </style>
    
    <script>
    (function() {
      const getHeaders = () => {
        const token = localStorage.getItem("admin_token");
        return token ? { 'Authorization': 'Bearer ' + token } : {};
      };
      
      const getValByLabel = (labelText, type = 'text', index = 0) => {
        const labels = Array.from(document.querySelectorAll('label'))
            .filter(l => l.innerText && l.innerText.includes(labelText));
        const labelEl = labels[index]; 
        if (!labelEl) return '';
        const parent = labelEl.parentElement;
        if (!parent) return '';
        const input = parent.querySelector('input, select, textarea');
        let val = input ? input.value : '';
        if (input && input.type === 'date' && val) {
          const [y, m, d] = val.split('-');
          return d + '.' + m + '.' + y;
        }
        return val;
      };

      const setValByLabel = (labelText, value, index = 0) => {
         const labels = Array.from(document.querySelectorAll('label'))
            .filter(l => l.innerText && l.innerText.includes(labelText));
         const labelEl = labels[index];
         if (!labelEl) return;
         const parent = labelEl.parentElement;
         if (!parent) return;
         const input = parent.querySelector('input, select, textarea');
         if (input) {
             const proto = Object.getPrototypeOf(input);
             const setter = Object.getOwnPropertyDescriptor(proto, 'value')?.set;
             if (setter) setter.call(input, value); else input.value = value;
             input.dispatchEvent(new Event('input', { bubbles: true }));
             input.dispatchEvent(new Event('change', { bubbles: true }));
         }
      };

      const scrapeSellerInfo = () => {
          return {
             kennelOwner: getValByLabel('–í–ª–∞–¥–µ–ª–µ—Ü –ø–∏—Ç–æ–º–Ω–∏–∫–∞'), 
             kennelAddress: getValByLabel('–ê–¥—Ä–µ—Å', 'text', 0), 
             kennelPhone: getValByLabel('–¢–µ–ª–µ—Ñ–æ–Ω', 'text', 0),
             kennelEmail: getValByLabel('Email', 'text', 0),
             kennelPassportSeries: getValByLabel('–ü–∞—Å–ø–æ—Ä—Ç —Å–µ—Ä–∏—è', 'text', 0),
             kennelPassportNumber: getValByLabel('–ü–∞—Å–ø–æ—Ä—Ç –Ω–æ–º–µ—Ä', 'text', 0),
             kennelPassportIssuedBy: getValByLabel('–ü–∞—Å–ø–æ—Ä—Ç –≤—ã–¥–∞–Ω', 'text', 0),
             kennelPassportIssuedDate: getValByLabel('–î–∞—Ç–∞ –≤—ã–¥–∞—á–∏ –ø–∞—Å–ø–æ—Ä—Ç–∞', 'date', 0)
          };
      };

      document.getElementById('btn-save-profile').addEventListener('click', async () => {
         const data = scrapeSellerInfo();
         console.log('üíæ SAVING DATA:', data);
         if (!data.kennelOwner) { alert('‚ùå –°–Ω–∞—á–∞–ª–∞ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –§–ò–û –∏ –¥—Ä—É–≥–∏–µ —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ, –∑–∞—Ç–µ–º –∂–º–∏—Ç–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ.'); return; }
         try {
             await fetch('/api/api.php?action=save_seller_profile', {
                 method: 'POST',
                 headers: getHeaders(),
                 body: JSON.stringify(data)
             });
             alert('‚úÖ –í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã! –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –Ω–µ –≤–≤–æ–¥–∏—Ç—å –∏—Ö –≤—Ä—É—á–Ω—É—é.');
         } catch(e) { alert('Error: ' + e.message); }
      });

      document.getElementById('btn-load-profile').addEventListener('click', async () => {
         try {
             const res = await fetch('/api/api.php?action=get_seller_profile', { headers: getHeaders() });
             let data = await res.json();
             console.log('üì• LOADED DATA:', data);
             if (!data || Object.keys(data).length === 0) {
                 alert('‚ö†Ô∏è –ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.'); return;
             }
             setValByLabel('–í–ª–∞–¥–µ–ª–µ—Ü –ø–∏—Ç–æ–º–Ω–∏–∫–∞', data.kennelOwner || '');
             setValByLabel('–ê–¥—Ä–µ—Å', data.kennelAddress || '', 0);
             setValByLabel('–¢–µ–ª–µ—Ñ–æ–Ω', data.kennelPhone || '', 0);
             setValByLabel('Email', data.kennelEmail || '', 0);
             setValByLabel('–ü–∞—Å–ø–æ—Ä—Ç —Å–µ—Ä–∏—è', data.kennelPassportSeries || '', 0);
             setValByLabel('–ü–∞—Å–ø–æ—Ä—Ç –Ω–æ–º–µ—Ä', data.kennelPassportNumber || '', 0);
             setValByLabel('–ü–∞—Å–ø–æ—Ä—Ç –≤—ã–¥–∞–Ω', data.kennelPassportIssuedBy || '', 0);
             
             let dateVal = data.kennelPassportIssuedDate;
             if (dateVal && dateVal.includes('.')) {
                 const [d, m, y] = dateVal.split('.');
                 dateVal = y + '-' + m + '-' + d;
             }
             setValByLabel('–î–∞—Ç–∞ –≤—ã–¥–∞—á–∏ –ø–∞—Å–ø–æ—Ä—Ç–∞', dateVal || '', 0);
             alert('‚úÖ –í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –≤—Å—Ç–∞–≤–ª–µ–Ω—ã!');
         } catch(e) { console.error(e); alert('Error loading profile: ' + e.message); }
      });

      const checkUiVisibility = () => {
         let ui = document.getElementById('vanilla-profile-ui');
         if (!ui) return;
         const container = document.getElementById('vanilla-profile-buttons-container');
         
         if (container) {
             ui.style.display = 'flex';
             if (ui.parentElement !== container) {
                 container.appendChild(ui);
             }
         } else {
             ui.style.display = 'none';
         }
      };
      setInterval(checkUiVisibility, 1000);
      checkUiVisibility();
    })();
    </script>
  </body>
</html>
