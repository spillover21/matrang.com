<!doctype html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/x-icon" href="/favicon.ico?v=2" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MATRANG DOGS</title>
    <meta name="description" content="–ø–∏—Ç–æ–º–Ω–∏–∫ –∞–º–µ—Ä–∏–∫–∞–Ω—Å–∫–∏—Ö –±—É–ª–ª–∏ Great Legacy bully" />
    <meta name="author" content="MATRANG Kennel" />

    <meta property="og:title" content="MATRANG" />
    <meta property="og:description" content="–ø–∏—Ç–æ–º–Ω–∏–∫ –∞–º–µ—Ä–∏–∫–∞–Ω—Å–∫–∏—Ö –±—É–ª–ª–∏ Great Legacy bully" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://matrang.com/" />
    <meta property="og:image" content="https://matrang.com/uploads/1767891439_85337ea8.png" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@MATRANG" />
    <meta name="twitter:image" content="/assets/hero-pitbull.jpg" />
    
    <script>
      // DEBUG: –ü–µ—Ä–µ—Ö–≤–∞—Ç –∫–ª–∏–∫–æ–≤ –Ω–∞ –≤—Å–µ—Ö –∫–Ω–æ–ø–∫–∞—Ö
      window.addEventListener('DOMContentLoaded', function() {
        console.error('üü¢ DEBUG SCRIPT LOADED at ' + new Date().toISOString());
        
        setInterval(function() {
          const sendButton = Array.from(document.querySelectorAll('button')).find(btn => 
            btn.textContent && (btn.textContent.includes('–û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ email') || btn.textContent.includes('–û—Ç–ø—Ä–∞–≤–∫–∞'))
          );
          
          if (sendButton && !sendButton.dataset.debugAttached) {
            sendButton.dataset.debugAttached = 'true';
            console.error('üîµ Found send button, attaching debug listener');
            
            sendButton.addEventListener('click', function(e) {
              console.error('üî¥üî¥üî¥ BUTTON CLICKED!', e);
              alert('üî¥ BUTTON CLICKED! Time: ' + Date.now());
              window.__BUTTON_CLICKED = Date.now();
            }, true); // capture phase
          }
        }, 1000);
      });
    </script>




    <script type="module" crossorigin src="/assets/index-sKnweAqN-1769466368072.js"></script>
    <link rel="stylesheet" crossorigin href="/assets/index-D35cW1RB.css">
    <script src="https://cdn.jsdelivr.net/npm/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
  </head>

  <body>
    <div id="root"></div>
    
    <!-- VANILLA JS –ò–ù–¢–ï–†–§–ï–ô–° –ö–ê–ö test_pdf_fill.html -->
    <div id="vanilla-contract-ui" style="position: fixed; top: 100px; right: 20px; z-index: 9999; background: #fef3c7; border: 3px solid #f59e0b; padding: 20px; border-radius: 10px; max-width: 400px; box-shadow: 0 10px 30px rgba(0,0,0,0.3);">
      <h2 style="margin: 0 0 15px 0; color: #92400e; font-size: 18px; font-weight: bold;">üìã –û–¢–ü–†–ê–í–ö–ê –î–û–ì–û–í–û–†–ê</h2>
      
      <div style="margin-bottom: 10px;">
        <label style="display: block; margin-bottom: 5px; font-weight: bold; color: #92400e;">PDF:</label>
        <input type="file" id="vanilla-pdf-template" accept=".pdf" style="width: 100%; padding: 8px; border: 2px solid #f59e0b; border-radius: 5px;">
      </div>
      
      <div style="margin-bottom: 10px;">
        <label style="display: block; margin-bottom: 5px; font-weight: bold; color: #92400e;">Email:</label>
        <input type="email" id="vanilla-email" placeholder="test@example.com" style="width: 100%; padding: 8px; border: 2px solid #f59e0b; border-radius: 5px;">
      </div>
      
      <button id="vanilla-fill-btn" style="width: 100%; padding: 12px; margin-bottom: 8px; background: #3b82f6; color: white; border: none; border-radius: 5px; font-weight: bold; cursor: pointer;">üîß –ó–∞–ø–æ–ª–Ω–∏—Ç—å</button>
      <button id="vanilla-download-btn" style="width: 100%; padding: 12px; margin-bottom: 8px; background: #10b981; color: white; border: none; border-radius: 5px; font-weight: bold; cursor: pointer;">üíæ –°–∫–∞—á–∞—Ç—å</button>
      <button id="vanilla-send-btn" style="width: 100%; padding: 12px; background: #ef4444; color: white; border: none; border-radius: 5px; font-weight: bold; cursor: pointer;">üìß –û–¢–ü–†–ê–í–ò–¢–¨</button>
      
      <p id="vanilla-status" style="margin: 10px 0 0 0; font-size: 12px; color: #92400e;">üí° –ó–∞–≥—Ä—É–∑–∏—Ç–µ PDF</p>
    </div>
    
    <script>
    (function() {
      const { PDFDocument } = PDFLib;
      let filledPdfBytes = null;
      let pdfTemplate = null;
      
      const status = document.getElementById('vanilla-status');
      const setStatus = (msg) => { status.textContent = msg; };
      
      document.getElementById('vanilla-pdf-template').addEventListener('change', async (e) => {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (ev) => {
          pdfTemplate = ev.target.result;
          setStatus('‚úÖ PDF: ' + file.name);
        };
        reader.readAsDataURL(file);
      });
      
      document.getElementById('vanilla-fill-btn').addEventListener('click', async () => {
        if (!pdfTemplate) { alert('–ó–∞–≥—Ä—É–∑–∏—Ç–µ PDF!'); return; }
        
        try {
          setStatus('‚è≥ –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ...');
          const pdfBytes = await fetch(pdfTemplate).then(res => res.arrayBuffer());
          const pdfDoc = await PDFDocument.load(pdfBytes);
          const form = pdfDoc.getForm();
          
          const fieldMap = {
            '`kennelName`': 'MATRANG',
            '`kennelAddress`': '–ú–æ—Å–∫–≤–∞',
            '`buyerName`': '–¢–µ—Å—Ç',
            '`buyerEmail`': document.getElementById('vanilla-email').value || 'test@test.com',
            '`contractNumber`': '001',
            '`contractDate`': new Date().toLocaleDateString('ru-RU'),
            '`dogName`': '–°–û–ë–ê–ö–ê',
            '`totalPrice`': '50000'
          };
          
          let filled = 0;
          for (const [name, val] of Object.entries(fieldMap)) {
            try {
              form.getTextField(name).setText(String(val));
              filled++;
            } catch {}
          }
          
          filledPdfBytes = await pdfDoc.save({ updateFieldAppearances: false });
          setStatus(`‚úÖ –ó–∞–ø–æ–ª–Ω–µ–Ω–æ: ${filled}`);
          alert(`‚úÖ ${filled} –ø–æ–ª–µ–π`);
        } catch (err) {
          setStatus('‚ùå ' + err.message);
          alert('‚ùå ' + err.message);
        }
      });
      
      document.getElementById('vanilla-download-btn').addEventListener('click', () => {
        if (!filledPdfBytes) { alert('–°–Ω–∞—á–∞–ª–∞ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ!'); return; }
        const blob = new Blob([filledPdfBytes], { type: 'application/pdf' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `contract_${Date.now()}.pdf`;
        a.click();
        setStatus('‚úÖ –°–∫–∞—á–∞–Ω');
      });
      
      document.getElementById('vanilla-send-btn').addEventListener('click', async () => {
        if (!filledPdfBytes) { alert('–°–Ω–∞—á–∞–ª–∞ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ!'); return; }
        const email = document.getElementById('vanilla-email').value;
        if (!email) { alert('–£–∫–∞–∂–∏—Ç–µ email!'); return; }
        
        try {
          setStatus('‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞...');
          const blob = new Blob([filledPdfBytes], { type: 'application/pdf' });
          const fd = new FormData();
          fd.append('file', blob, 'contract.pdf');
          
          const upRes = await fetch('/api/api.php?action=uploadcontract', { method: 'POST', body: fd });
          const upData = await upRes.json();
          
          if (!upData.success) throw new Error(upData.message);
          
          const emailRes = await fetch('/api/api.php?action=sendContractPdf', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              data: { buyerEmail: email },
              pdfTemplate: upData.path,
              useUploadedPdf: true
            })
          });
          
          const emailData = await emailRes.json();
          if (emailData.success) {
            setStatus(`‚úÖ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ ${email}`);
            alert(`‚úÖ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!`);
          } else {
            throw new Error(emailData.message);
          }
        } catch (err) {
          setStatus('‚ùå ' + err.message);
          alert('‚ùå ' + err.message);
        }
      });
    })();
    </script>
  </body>
</html>
